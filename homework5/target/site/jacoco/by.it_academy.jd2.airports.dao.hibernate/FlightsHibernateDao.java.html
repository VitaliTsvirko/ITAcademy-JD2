<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FlightsHibernateDao.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">homework5-airports</a> &gt; <a href="index.source.html" class="el_package">by.it_academy.jd2.airports.dao.hibernate</a> &gt; <span class="el_source">FlightsHibernateDao.java</span></div><h1>FlightsHibernateDao.java</h1><pre class="source lang-java linenums">package by.it_academy.jd2.airports.dao.hibernate;

import by.it_academy.jd2.airports.core.dto.Flights;
import by.it_academy.jd2.airports.core.dto.Lang;
import by.it_academy.jd2.airports.dao.api.IFlightsDao;
import by.it_academy.jd2.airports.dao.core.HibernateCreator;
import org.hibernate.Session;
import org.hibernate.query.Query;

import java.beans.PropertyVetoException;
import java.sql.*;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.OffsetDateTime;
import java.time.ZoneOffset;
import java.time.format.DateTimeFormatter;
import java.util.List;

/**
 * @author Vitali Tsvirko
 */
public class FlightsHibernateDao implements IFlightsDao {
<span class="nc" id="L23">    private final Session dataSource = HibernateCreator.getInstance().openSession();</span>
<span class="nc" id="L24">    private final ZoneOffset offset = ZoneOffset.UTC;</span>

<span class="nc" id="L26">    public FlightsHibernateDao() throws PropertyVetoException {</span>
<span class="nc" id="L27">    }</span>

    @Override
    public int getFlightsCountByAirportsCode(String departureAirportCode, String arrivalAirportCode) throws IllegalAccessException {


<span class="nc" id="L33">        Query query = dataSource.createQuery(&quot;Select count (*) from Flights WHERE departureAirportCode=:departureAirportCode AND arrivalAirportCode=:arrivalAirportCode&quot;);</span>
<span class="nc" id="L34">        query.setParameter(&quot;departureAirportCode&quot;, departureAirportCode);</span>
<span class="nc" id="L35">        query.setParameter(&quot;arrivalAirportCode&quot;, arrivalAirportCode);</span>

<span class="nc" id="L37">        Long result = (Long) query.getSingleResult();</span>

<span class="nc" id="L39">        return result.intValue();</span>
    }

    @Override
    public int getFlightsCountByAirportsCodeAndDates(String departureAirportCode, String arrivalAirportCode, LocalDate departureDate, LocalDate arrivalDate) throws IllegalAccessException {
<span class="nc" id="L44">        Query query = dataSource.createQuery(&quot;Select count (*) from Flights WHERE (departureAirportCode=:departureAirportCode AND scheduledDeparture&gt;:scheduledDepartureBegin AND scheduledDeparture&lt;=:scheduledDepartureEnd)&quot; +</span>
                &quot;OR (arrivalAirportCode=:arrivalAirportCode AND scheduledArrival&gt;:scheduledArrivalBegin AND scheduledArrival&lt;=:scheduledArrivalEnd)&quot;);
<span class="nc" id="L46">        query.setParameter(&quot;departureAirportCode&quot;, departureAirportCode);</span>
<span class="nc" id="L47">        query.setParameter(&quot;arrivalAirportCode&quot;, arrivalAirportCode);</span>
<span class="nc" id="L48">        query.setParameter(&quot;scheduledDepartureBegin&quot;, departureDate.atTime(00,00,00).atOffset(this.offset));</span>
<span class="nc" id="L49">        query.setParameter(&quot;scheduledDepartureEnd&quot;, departureDate.atTime(23,59,59).atOffset(this.offset));</span>
<span class="nc" id="L50">        query.setParameter(&quot;scheduledArrivalBegin&quot;, arrivalDate.atTime(00,00,00).atOffset(this.offset));</span>
<span class="nc" id="L51">        query.setParameter(&quot;scheduledArrivalEnd&quot;, arrivalDate.atTime(23,59,59).atOffset(this.offset));</span>

<span class="nc" id="L53">        Long result = (Long) query.getSingleResult();</span>

<span class="nc" id="L55">        return result.intValue();</span>
    }

    @Override
    public List&lt;Flights&gt; getFlightsByAirportsCodeAndDates(Lang lang, String departureAirportCode, String arrivalAirportCode, LocalDate departureDate, LocalDate arrivalDate, int limit, int offset) throws IllegalAccessException {
<span class="nc" id="L60">        Query query = dataSource.createQuery(&quot;from Flights WHERE (departureAirportCode=:departureAirportCode AND scheduledDeparture&gt;:scheduledDepartureBegin AND scheduledDeparture&lt;=:scheduledDepartureEnd)&quot; +</span>
                &quot;OR (arrivalAirportCode=:arrivalAirportCode AND scheduledArrival&gt;:scheduledArrivalBegin AND scheduledArrival&lt;=:scheduledArrivalEnd)&quot;);
<span class="nc" id="L62">        query.setParameter(&quot;departureAirportCode&quot;, departureAirportCode);</span>
<span class="nc" id="L63">        query.setParameter(&quot;arrivalAirportCode&quot;, arrivalAirportCode);</span>
<span class="nc" id="L64">        query.setParameter(&quot;scheduledDepartureBegin&quot;, departureDate.atTime(00,00,00).atOffset(this.offset));</span>
<span class="nc" id="L65">        query.setParameter(&quot;scheduledDepartureEnd&quot;, departureDate.atTime(23,59,59).atOffset(this.offset));</span>
<span class="nc" id="L66">        query.setParameter(&quot;scheduledArrivalBegin&quot;, arrivalDate.atTime(00,00,00).atOffset(this.offset));</span>
<span class="nc" id="L67">        query.setParameter(&quot;scheduledArrivalEnd&quot;, arrivalDate.atTime(23,59,59).atOffset(this.offset));</span>
<span class="nc" id="L68">        query.setFirstResult(offset);</span>
<span class="nc" id="L69">        query.setMaxResults(limit);</span>

<span class="nc" id="L71">        List&lt;Flights&gt; result = (List&lt;Flights&gt;) query.list();</span>

<span class="nc" id="L73">        return result;</span>
    }

    @Override
    public List&lt;Flights&gt; getFlightsByAirportsCode(Lang lang, String departureAirportCode, String arrivalAirportCode, int limit, int offset) throws IllegalAccessException {

<span class="nc" id="L79">        Query query = dataSource.createQuery(&quot;from Flights WHERE departureAirportCode=:departureAirportCode AND arrivalAirportCode=:arrivalAirportCode&quot;);</span>
<span class="nc" id="L80">        query.setParameter(&quot;departureAirportCode&quot;, departureAirportCode);</span>
<span class="nc" id="L81">        query.setParameter(&quot;arrivalAirportCode&quot;, arrivalAirportCode);</span>
<span class="nc" id="L82">        query.setFirstResult(offset);</span>
<span class="nc" id="L83">        query.setMaxResults(limit);</span>

<span class="nc" id="L85">        List&lt;Flights&gt; result = (List&lt;Flights&gt;) query.list();</span>

<span class="nc" id="L87">        return result;</span>
    }


    public static void main(String[] args) throws PropertyVetoException, IllegalAccessException {
<span class="nc" id="L92">        FlightsHibernateDao dao = new FlightsHibernateDao();</span>

<span class="nc" id="L94">        List&lt;Flights&gt; flightsByAirportsCode = dao.getFlightsByAirportsCode(Lang.RU, &quot;DME&quot;, &quot;ROV&quot;, 25, 50);</span>


<span class="nc" id="L97">        List&lt;Flights&gt; flightsByAirportsCodeAndDates = dao.getFlightsByAirportsCodeAndDates(Lang.RU, &quot;DME&quot;, &quot;ROV&quot;, LocalDate.parse(&quot;2017-04-09&quot;), LocalDate.parse(&quot;2017-04-09&quot;), 25, 50);</span>

<span class="nc" id="L99">        System.out.println(flightsByAirportsCode.size());</span>

<span class="nc" id="L101">        LocalDateTime now = LocalDateTime.now();</span>

<span class="nc" id="L103">        System.out.println(now);</span>

<span class="nc" id="L105">        LocalDate date = LocalDate.now();</span>
<span class="nc" id="L106">        ZoneOffset offset = ZoneOffset.UTC;</span>
<span class="nc" id="L107">        OffsetDateTime odt = date.atStartOfDay(offset).toOffsetDateTime();</span>

<span class="nc" id="L109">        DateTimeFormatter dateTimeFormat = DateTimeFormatter.ofPattern(&quot;dd.MM.yyyy hh:mm&quot;);</span>
<span class="nc" id="L110">        String format1 = flightsByAirportsCodeAndDates.get(1).getActualDeparture().toLocalDateTime().format(dateTimeFormat);</span>


<span class="nc" id="L113">        LocalDateTime parse = date.atTime(23,59,00);;</span>
<span class="nc" id="L114">        odt = parse.atOffset(offset);</span>

<span class="nc" id="L116">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>